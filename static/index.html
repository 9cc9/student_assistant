<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠ©æ•™è¯„ä¼°ç³»ç»Ÿ - é¡¹ç›®æäº¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .upload-area {
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        .result-card {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <!-- å¤´éƒ¨ -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="container mx-auto px-6 py-8">
                <h1 class="text-4xl font-bold text-center">
                    <i class="fas fa-robot mr-3"></i>AIåŠ©æ•™è¯„ä¼°ç³»ç»Ÿ
                </h1>
                <p class="text-center mt-3 text-lg opacity-90">æ™ºèƒ½è¯„ä¼°æ‚¨çš„é¡¹ç›®åˆ›æ„ã€UIè®¾è®¡å’Œä»£ç è´¨é‡</p>
            </div>
        </header>

        <!-- ä¸»è¦å†…å®¹ -->
        <main class="container mx-auto px-6 py-12">
            <!-- æäº¤æ–¹å¼é€‰æ‹© -->
            <div class="max-w-4xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">é€‰æ‹©é¡¹ç›®æäº¤æ–¹å¼</h2>
                    <p class="text-gray-600 text-lg">æ”¯æŒæ–‡ä»¶ä¸Šä¼ æˆ–Gitä»“åº“é“¾æ¥ä¸¤ç§æ–¹å¼</p>
                </div>

                <!-- é€‰é¡¹å¡ -->
                <div class="mb-8">
                    <div class="flex border-b">
                        <button 
                            @click="activeTab = 'upload'"
                            :class="['px-6 py-3 font-semibold text-lg border-b-2', 
                                    activeTab === 'upload' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500']">
                            <i class="fas fa-upload mr-2"></i>æ–‡ä»¶ä¸Šä¼ 
                        </button>
                        <button 
                            @click="activeTab = 'git'"
                            :class="['px-6 py-3 font-semibold text-lg border-b-2 ml-8', 
                                    activeTab === 'git' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500']">
                            <i class="fab fa-git-alt mr-2"></i>Gitä»“åº“
                        </button>
                    </div>
                </div>

                <!-- æ–‡ä»¶ä¸Šä¼ æ¨¡å¼ -->
                <div v-show="activeTab === 'upload'" class="bg-white rounded-xl card-shadow p-8">
                    <form @submit.prevent="submitFiles" enctype="multipart/form-data">
                        <div class="space-y-6">
                            <!-- å­¦ç”Ÿä¿¡æ¯ -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">å­¦ç”ŸID</label>
                                <input 
                                    v-model="uploadForm.studentId" 
                                    type="text" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="è¯·è¾“å…¥å­¦ç”ŸID">
                            </div>

                            <!-- é¡¹ç›®åˆ›æ„ -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">é¡¹ç›®åˆ›æ„æè¿°</label>
                                <textarea 
                                    v-model="uploadForm.ideaText" 
                                    rows="6" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„é¡¹ç›®åˆ›æ„ã€ç›®æ ‡ç”¨æˆ·ã€æ ¸å¿ƒåŠŸèƒ½ç­‰..."></textarea>
                            </div>

                            <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">ä¸Šä¼ é¡¹ç›®æ–‡ä»¶</label>
                                <div 
                                    @dragover.prevent
                                    @drop.prevent="handleFileDrop"
                                    class="upload-area border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer"
                                    :class="{'border-blue-500 bg-blue-50': isDragging}"
                                    @dragenter="isDragging = true"
                                    @dragleave="isDragging = false">
                                    
                                    <div v-if="selectedFiles.length === 0">
                                        <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                                        <p class="text-xl text-gray-600 mb-2">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©</p>
                                        <p class="text-gray-500">æ”¯æŒ .zip, .tar.gz å‹ç¼©åŒ…æˆ–å•ä¸ªä»£ç æ–‡ä»¶</p>
                                        <input 
                                            ref="fileInput"
                                            @change="handleFileSelect"
                                            type="file" 
                                            multiple 
                                            class="hidden"
                                            accept=".py,.js,.ts,.tsx,.jsx,.java,.cpp,.c,.zip,.tar.gz">
                                        <button 
                                            type="button"
                                            @click="$refs.fileInput.click()"
                                            class="mt-4 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                                            é€‰æ‹©æ–‡ä»¶
                                        </button>
                                    </div>
                                    
                                    <div v-else>
                                        <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                                        <p class="text-xl text-green-600 mb-4">å·²é€‰æ‹© {{ selectedFiles.length }} ä¸ªæ–‡ä»¶</p>
                                        <div class="text-left bg-gray-50 rounded-lg p-4 max-h-40 overflow-y-auto">
                                            <div v-for="file in selectedFiles" :key="file.name" class="flex items-center justify-between py-1">
                                                <span class="text-sm text-gray-700">{{ file.name }}</span>
                                                <span class="text-xs text-gray-500">{{ formatFileSize(file.size) }}</span>
                                            </div>
                                        </div>
                                        <button 
                                            type="button"
                                            @click="clearFiles"
                                            class="mt-4 text-red-500 hover:text-red-600">
                                            <i class="fas fa-times mr-1"></i>æ¸…é™¤æ–‡ä»¶
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- æäº¤æŒ‰é’® -->
                            <button 
                                type="submit"
                                :disabled="loading || selectedFiles.length === 0"
                                class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 px-8 rounded-lg font-semibold text-lg
                                       hover:from-blue-600 hover:to-purple-700 transition duration-300 disabled:opacity-50">
                                <span v-if="loading">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>ä¸Šä¼ ä¸­...
                                </span>
                                <span v-else>
                                    <i class="fas fa-rocket mr-2"></i>æäº¤é¡¹ç›®è¯„ä¼°
                                </span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Gitä»“åº“æ¨¡å¼ -->
                <div v-show="activeTab === 'git'" class="bg-white rounded-xl card-shadow p-8">
                    <form @submit.prevent="submitGit">
                        <div class="space-y-6">
                            <!-- å­¦ç”Ÿä¿¡æ¯ -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">å­¦ç”ŸID</label>
                                <input 
                                    v-model="gitForm.studentId" 
                                    type="text" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="è¯·è¾“å…¥å­¦ç”ŸID">
                            </div>

                            <!-- Gitä»“åº“URL -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Gitä»“åº“URL</label>
                                <input 
                                    v-model="gitForm.repoUrl" 
                                    type="url" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="https://github.com/username/project.git">
                            </div>

                            <!-- åˆ†æ”¯åç§° -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">åˆ†æ”¯åç§°</label>
                                <input 
                                    v-model="gitForm.branch" 
                                    type="text"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="main (é»˜è®¤)">
                            </div>

                            <!-- é¡¹ç›®åˆ›æ„ -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">é¡¹ç›®åˆ›æ„æè¿°</label>
                                <textarea 
                                    v-model="gitForm.ideaText" 
                                    rows="6" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„é¡¹ç›®åˆ›æ„ã€ç›®æ ‡ç”¨æˆ·ã€æ ¸å¿ƒåŠŸèƒ½ç­‰..."></textarea>
                            </div>

                            <!-- æäº¤æŒ‰é’® -->
                            <button 
                                type="submit"
                                :disabled="loading"
                                class="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white py-4 px-8 rounded-lg font-semibold text-lg
                                       hover:from-green-600 hover:to-blue-700 transition duration-300 disabled:opacity-50">
                                <span v-if="loading">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>å…‹éš†ä¸­...
                                </span>
                                <span v-else>
                                    <i class="fab fa-git-alt mr-2"></i>æäº¤Gité¡¹ç›®è¯„ä¼°
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- è¯„ä¼°ç»“æœæ˜¾ç¤º -->
            <div v-if="assessmentResult" class="max-w-6xl mx-auto mt-16">
                <div class="result-card bg-white rounded-xl card-shadow overflow-hidden">
                    <!-- ç»“æœå¤´éƒ¨ -->
                    <div class="bg-gradient-to-r from-green-500 to-blue-600 text-white p-6">
                        <h3 class="text-2xl font-bold mb-2">
                            <i class="fas fa-check-circle mr-3"></i>è¯„ä¼°æäº¤æˆåŠŸ
                        </h3>
                        <p class="opacity-90">è¯„ä¼°ID: {{ assessmentResult.assessment_id }}</p>
                    </div>

                    <div class="p-8">
                        <!-- é¡¹ç›®åˆ†æ -->
                        <div class="mb-8">
                            <h4 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-chart-bar mr-2 text-blue-500"></i>é¡¹ç›®åˆ†æ
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <div class="text-2xl font-bold text-blue-600">{{ assessmentResult.analysis?.total_files || 0 }}</div>
                                    <div class="text-sm text-gray-600">æ€»æ–‡ä»¶æ•°</div>
                                </div>
                                <div class="bg-green-50 rounded-lg p-4">
                                    <div class="text-2xl font-bold text-green-600">{{ assessmentResult.analysis?.code_files || 0 }}</div>
                                    <div class="text-sm text-gray-600">ä»£ç æ–‡ä»¶</div>
                                </div>
                                <div class="bg-purple-50 rounded-lg p-4">
                                    <div class="text-2xl font-bold text-purple-600">{{ assessmentResult.analysis?.lines_of_code || 0 }}</div>
                                    <div class="text-sm text-gray-600">ä»£ç è¡Œæ•°</div>
                                </div>
                            </div>

                            <!-- æŠ€æœ¯æ ˆ -->
                            <div v-if="assessmentResult.analysis?.languages" class="mt-6">
                                <h5 class="font-semibold text-gray-700 mb-3">ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€:</h5>
                                <div class="flex flex-wrap gap-2">
                                    <span 
                                        v-for="(count, lang) in assessmentResult.analysis.languages" 
                                        :key="lang"
                                        class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">
                                        {{ lang }} ({{ count }})
                                    </span>
                                </div>
                            </div>

                            <!-- æ¡†æ¶ -->
                            <div v-if="assessmentResult.analysis?.frameworks?.length" class="mt-4">
                                <h5 class="font-semibold text-gray-700 mb-3">æ£€æµ‹åˆ°çš„æ¡†æ¶:</h5>
                                <div class="flex flex-wrap gap-2">
                                    <span 
                                        v-for="framework in assessmentResult.analysis.frameworks" 
                                        :key="framework"
                                        class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm">
                                        {{ framework }}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- è¯„ä¼°çŠ¶æ€ -->
                        <div class="mb-6">
                            <h4 class="text-xl font-semibold mb-4 text-gray-800">
                                <i :class="getStatusIcon()" class="mr-2"></i>è¯„ä¼°è¿›åº¦
                            </h4>
                            <div :class="getStatusClass()" class="p-4 rounded">
                                <p :class="getStatusTextClass()">
                                    {{ getStatusMessage() }}
                                    <button @click="checkAssessmentStatus" class="ml-4 text-blue-500 hover:text-blue-600">
                                        <i class="fas fa-sync-alt mr-1" :class="{'fa-spin': loading}"></i>åˆ·æ–°çŠ¶æ€
                                    </button>
                                </p>
                                <div v-if="assessmentStatus === 'in_progress'" class="mt-2">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-orange-500 h-2 rounded-full animate-pulse" style="width: 60%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- æ“ä½œæŒ‰é’® -->
                        <div class="flex gap-4">
                            <button 
                                @click="handleResultAction"
                                :disabled="loading"
                                :class="getResultButtonClass()"
                                class="px-6 py-2 rounded-lg transition disabled:opacity-50">
                                <i :class="getResultButtonIcon()" class="mr-2"></i>{{ getResultButtonText() }}
                            </button>
                            <button 
                                @click="resetForm"
                                class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition">
                                <i class="fas fa-plus mr-2"></i>æäº¤æ–°é¡¹ç›®
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¯¦ç»†è¯„ä¼°ç»“æœ -->
            <div v-if="detailedResult" class="max-w-6xl mx-auto mt-12">
                <div class="result-card bg-white rounded-xl card-shadow overflow-hidden">
                    <!-- è¯„åˆ†æ€»è§ˆ -->
                    <div class="bg-gradient-to-r from-purple-500 to-pink-600 text-white p-6">
                        <h3 class="text-2xl font-bold mb-2">
                            <i class="fas fa-trophy mr-3"></i>è¯„ä¼°ç»“æœ
                        </h3>
                        <div class="text-3xl font-bold">æ€»åˆ†: {{ detailedResult.overall_score?.toFixed(1) || 0 }}/100</div>
                    </div>

                    <div class="p-8">
                        <!-- å„ç»´åº¦è¯„åˆ† -->
                        <div class="mb-8">
                            <h4 class="text-xl font-semibold mb-6 text-gray-800">å„ç»´åº¦è¯„åˆ†</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="text-center">
                                    <div class="text-4xl font-bold text-blue-500 mb-2">{{ detailedResult.breakdown?.idea?.toFixed(1) || 0 }}</div>
                                    <div class="text-gray-600 font-semibold">åˆ›æ„æƒ³æ³• (30%)</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                        <div class="bg-blue-500 h-2 rounded-full" :style="{width: (detailedResult.breakdown?.idea || 0) + '%'}"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl font-bold text-green-500 mb-2">{{ detailedResult.breakdown?.ui?.toFixed(1) || 0 }}</div>
                                    <div class="text-gray-600 font-semibold">UIè®¾è®¡ (30%)</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                        <div class="bg-green-500 h-2 rounded-full" :style="{width: (detailedResult.breakdown?.ui || 0) + '%'}"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl font-bold text-purple-500 mb-2">{{ detailedResult.breakdown?.code?.toFixed(1) || 0 }}</div>
                                    <div class="text-gray-600 font-semibold">ä»£ç è´¨é‡ (40%)</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                        <div class="bg-purple-500 h-2 rounded-full" :style="{width: (detailedResult.breakdown?.code || 0) + '%'}"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- æ”¹è¿›å»ºè®® -->
                        <div v-if="detailedResult.diagnosis?.length" class="mb-8">
                            <h4 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>æ”¹è¿›å»ºè®®
                            </h4>
                            <div class="space-y-4">
                                <div 
                                    v-for="(diag, index) in detailedResult.diagnosis" 
                                    :key="index"
                                    class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                                    <div class="font-semibold text-yellow-800 mb-1">{{ diag.dim }}</div>
                                    <div class="text-yellow-700 mb-2">{{ diag.issue }}</div>
                                    <div class="text-yellow-600 text-sm">
                                        <strong>å»ºè®®:</strong> {{ diag.fix }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å­¦ä¹ èµ„æº -->
                        <div v-if="detailedResult.resources?.length" class="mb-8">
                            <h4 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-book mr-2 text-green-500"></i>æ¨èå­¦ä¹ èµ„æº
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div 
                                    v-for="resource in detailedResult.resources" 
                                    :key="resource"
                                    class="bg-green-50 text-green-700 px-4 py-2 rounded-lg">
                                    <i class="fas fa-external-link-alt mr-2"></i>{{ resource }}
                                </div>
                            </div>
                        </div>

                        <!-- å‡†å‡ºè§„åˆ™ -->
                        <div v-if="detailedResult.exit_rules" class="mb-6">
                            <h4 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-flag mr-2"></i>è¯„ä¼°çŠ¶æ€
                            </h4>
                            <div class="p-4 rounded-lg" :class="detailedResult.exit_rules.pass ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'">
                                <div class="flex items-center mb-2">
                                    <i :class="detailedResult.exit_rules.pass ? 'fas fa-check-circle text-green-500' : 'fas fa-times-circle text-red-500'" class="mr-2"></i>
                                    <span class="font-semibold" :class="detailedResult.exit_rules.pass ? 'text-green-700' : 'text-red-700'">
                                        {{ detailedResult.exit_rules.pass ? 'è¯„ä¼°é€šè¿‡' : 'éœ€è¦æ”¹è¿›' }}
                                    </span>
                                </div>
                                <div v-if="detailedResult.exit_rules.remedy?.length" class="text-sm" :class="detailedResult.exit_rules.pass ? 'text-green-600' : 'text-red-600'">
                                    <div v-for="remedy in detailedResult.exit_rules.remedy" :key="remedy" class="mt-1">
                                        â€¢ {{ remedy }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- é¡µè„š -->
        <footer class="bg-gray-800 text-white py-8 mt-16">
            <div class="container mx-auto px-6 text-center">
                <p>&copy; 2024 AIåŠ©æ•™è¯„ä¼°ç³»ç»Ÿ. All rights reserved.</p>
                <p class="mt-2 text-gray-400">åŸºäºé˜¿é‡Œäº‘é€šä¹‰åƒé—®çš„æ™ºèƒ½è¯„ä¼°å¹³å°</p>
            </div>
        </footer>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    activeTab: 'upload',
                    loading: false,
                    isDragging: false,
                    selectedFiles: [],
                    assessmentResult: null,
                    detailedResult: null,
                    assessmentStatus: null,
                    pollingInterval: null,
                    uploadForm: {
                        studentId: '',
                        ideaText: ''
                    },
                    gitForm: {
                        studentId: '',
                        repoUrl: '',
                        branch: 'main',
                        ideaText: ''
                    }
                }
            },
            methods: {
                handleFileSelect(event) {
                    this.selectedFiles = Array.from(event.target.files)
                },
                handleFileDrop(event) {
                    this.isDragging = false
                    this.selectedFiles = Array.from(event.dataTransfer.files)
                },
                clearFiles() {
                    this.selectedFiles = []
                    if (this.$refs.fileInput) {
                        this.$refs.fileInput.value = ''
                    }
                },
                formatFileSize(bytes) {
                    if (bytes === 0) return '0 B'
                    const k = 1024
                    const sizes = ['B', 'KB', 'MB', 'GB']
                    const i = Math.floor(Math.log(bytes) / Math.log(k))
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
                },
                async submitFiles() {
                    if (!this.uploadForm.studentId || !this.uploadForm.ideaText || this.selectedFiles.length === 0) {
                        alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«ä¿¡æ¯å¹¶é€‰æ‹©æ–‡ä»¶')
                        return
                    }

                    this.loading = true
                    try {
                        const formData = new FormData()
                        formData.append('student_id', this.uploadForm.studentId)
                        formData.append('idea_text', this.uploadForm.ideaText)
                        
                        this.selectedFiles.forEach(file => {
                            formData.append('files', file)
                        })

                        const response = await fetch('/api/upload/files', {
                            method: 'POST',
                            body: formData
                        })

                        if (response.ok) {
                            const result = await response.json()
                            this.assessmentResult = result
                            this.assessmentStatus = 'queued'  // åˆå§‹çŠ¶æ€
                            this.startPolling()  // å¼€å§‹è½®è¯¢
                            this.scrollToResult()
                        } else {
                            const error = await response.json()
                            alert('æäº¤å¤±è´¥: ' + (error.detail || 'æœªçŸ¥é”™è¯¯'))
                        }
                    } catch (error) {
                        alert('æäº¤å¤±è´¥: ' + error.message)
                    } finally {
                        this.loading = false
                    }
                },
                async submitGit() {
                    if (!this.gitForm.studentId || !this.gitForm.repoUrl || !this.gitForm.ideaText) {
                        alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«ä¿¡æ¯')
                        return
                    }

                    this.loading = true
                    try {
                        const response = await fetch('/api/upload/git', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                student_id: this.gitForm.studentId,
                                repo_url: this.gitForm.repoUrl,
                                branch: this.gitForm.branch || 'main',
                                idea_text: this.gitForm.ideaText
                            })
                        })

                        if (response.ok) {
                            const result = await response.json()
                            this.assessmentResult = result
                            this.assessmentStatus = 'queued'  // åˆå§‹çŠ¶æ€
                            this.startPolling()  // å¼€å§‹è½®è¯¢
                            this.scrollToResult()
                        } else {
                            const error = await response.json()
                            alert('æäº¤å¤±è´¥: ' + (error.detail || 'æœªçŸ¥é”™è¯¯'))
                        }
                    } catch (error) {
                        alert('æäº¤å¤±è´¥: ' + error.message)
                    } finally {
                        this.loading = false
                    }
                },
                async checkAssessmentStatus() {
                    if (!this.assessmentResult?.assessment_id) return

                    this.loading = true
                    try {
                        const response = await fetch(`/api/assessment/${this.assessmentResult.assessment_id}`)
                        if (response.ok) {
                            const result = await response.json()
                            this.assessmentStatus = result.status
                            
                            if (result.status === 'completed') {
                                this.detailedResult = result
                                this.stopPolling()
                            } else if (result.status === 'failed') {
                                this.stopPolling()
                            }
                        } else {
                            console.error('è·å–è¯„ä¼°çŠ¶æ€å¤±è´¥')
                        }
                    } catch (error) {
                        console.error('æ£€æŸ¥è¯„ä¼°çŠ¶æ€å¤±è´¥:', error)
                    } finally {
                        this.loading = false
                    }
                },
                startPolling() {
                    // æ¸…é™¤ä¹‹å‰çš„è½®è¯¢
                    this.stopPolling()
                    
                    // ç«‹å³æ£€æŸ¥ä¸€æ¬¡çŠ¶æ€
                    this.checkAssessmentStatus()
                    
                    // æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡çŠ¶æ€
                    this.pollingInterval = setInterval(() => {
                        if (this.assessmentStatus !== 'completed' && this.assessmentStatus !== 'failed') {
                            this.checkAssessmentStatus()
                        }
                    }, 3000)
                },
                stopPolling() {
                    if (this.pollingInterval) {
                        clearInterval(this.pollingInterval)
                        this.pollingInterval = null
                    }
                },
                handleResultAction() {
                    if (this.assessmentStatus === 'completed') {
                        // å¦‚æœå·²å®Œæˆï¼Œæ»šåŠ¨åˆ°è¯¦ç»†ç»“æœ
                        this.scrollToDetailedResult()
                    } else {
                        // å¦‚æœæœªå®Œæˆï¼Œæ£€æŸ¥çŠ¶æ€
                        this.checkAssessmentStatus()
                    }
                },
                getStatusIcon() {
                    switch (this.assessmentStatus) {
                        case 'completed':
                            return 'fas fa-check-circle text-green-500'
                        case 'failed':
                            return 'fas fa-times-circle text-red-500'
                        case 'in_progress':
                            return 'fas fa-cog fa-spin text-orange-500'
                        default:
                            return 'fas fa-clock text-gray-500'
                    }
                },
                getStatusClass() {
                    switch (this.assessmentStatus) {
                        case 'completed':
                            return 'bg-green-50 border-l-4 border-green-400'
                        case 'failed':
                            return 'bg-red-50 border-l-4 border-red-400'
                        case 'in_progress':
                            return 'bg-orange-50 border-l-4 border-orange-400'
                        default:
                            return 'bg-gray-50 border-l-4 border-gray-400'
                    }
                },
                getStatusTextClass() {
                    switch (this.assessmentStatus) {
                        case 'completed':
                            return 'text-green-700'
                        case 'failed':
                            return 'text-red-700'
                        case 'in_progress':
                            return 'text-orange-700'
                        default:
                            return 'text-gray-700'
                    }
                },
                getStatusMessage() {
                    switch (this.assessmentStatus) {
                        case 'completed':
                            return 'âœ… è¯„ä¼°å·²å®Œæˆï¼ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŸ¥çœ‹è¯¦ç»†ç»“æœ'
                        case 'failed':
                            return 'âŒ è¯„ä¼°å¤±è´¥ï¼Œè¯·æ£€æŸ¥æäº¤çš„é¡¹ç›®æˆ–é‡æ–°æäº¤'
                        case 'in_progress':
                            return 'â³ è¯„ä¼°æ­£åœ¨è¿›è¡Œä¸­ï¼ŒAIæ­£åœ¨åˆ†ææ‚¨çš„é¡¹ç›®...'
                        case 'queued':
                            return 'ğŸ“‹ è¯„ä¼°å·²æ’é˜Ÿï¼Œæ­£åœ¨å‡†å¤‡å¼€å§‹...'
                        default:
                            return 'ğŸ“‹ å‡†å¤‡å¼€å§‹è¯„ä¼°...'
                    }
                },
                getResultButtonClass() {
                    return this.assessmentStatus === 'completed' 
                        ? 'bg-green-500 text-white hover:bg-green-600'
                        : 'bg-blue-500 text-white hover:bg-blue-600'
                },
                getResultButtonIcon() {
                    return this.assessmentStatus === 'completed' 
                        ? 'fas fa-trophy' 
                        : 'fas fa-sync-alt'
                },
                getResultButtonText() {
                    return this.assessmentStatus === 'completed' 
                        ? 'æŸ¥çœ‹è¯¦ç»†ç»“æœ' 
                        : 'åˆ·æ–°è¯„ä¼°çŠ¶æ€'
                },
                scrollToResult() {
                    this.$nextTick(() => {
                        const element = document.querySelector('.result-card')
                        if (element) {
                            element.scrollIntoView({ behavior: 'smooth' })
                        }
                    })
                },
                scrollToDetailedResult() {
                    this.$nextTick(() => {
                        const element = document.querySelector('.result-card:last-child')
                        if (element) {
                            element.scrollIntoView({ behavior: 'smooth' })
                        }
                    })
                },
                resetForm() {
                    this.stopPolling()  // åœæ­¢è½®è¯¢
                    this.assessmentResult = null
                    this.detailedResult = null
                    this.assessmentStatus = null
                    this.selectedFiles = []
                    this.uploadForm = { studentId: '', ideaText: '' }
                    this.gitForm = { studentId: '', repoUrl: '', branch: 'main', ideaText: '' }
                    if (this.$refs.fileInput) {
                        this.$refs.fileInput.value = ''
                    }
                    window.scrollTo({ top: 0, behavior: 'smooth' })
                }
            },
            // ç»„ä»¶é”€æ¯æ—¶æ¸…ç†è½®è¯¢
            beforeUnmount() {
                this.stopPolling()
            }
        }).mount('#app')
    </script>
</body>
</html>
