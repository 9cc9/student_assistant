<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI助教评估与个性化学习路径系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .upload-area {
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        .result-card {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .path-node {
            transition: all 0.3s ease;
        }
        .path-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .progress-bar {
            background: linear-gradient(90deg, #4f46e5 0%, #06b6d4 100%);
        }
        .diagnostic-card {
            background: linear-gradient(135deg, #f6f9fc 0%, #ffffff 100%);
            border: 2px solid transparent;
            background-clip: padding-box;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <!-- 头部 -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="container mx-auto px-6 py-8">
                <h1 class="text-4xl font-bold text-center">
                    <i class="fas fa-robot mr-3"></i>AI助教评估与个性化学习路径系统
                </h1>
                <p class="text-center mt-3 text-lg opacity-90">智能评估 + 个性化学习 = 因材施教</p>
            </div>
        </header>

        <!-- 主要内容 -->
        <main class="container mx-auto px-6 py-12">
            <!-- 选项卡导航 -->
            <div class="max-w-6xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">智能教学平台</h2>
                    <p class="text-gray-600 text-lg">集成AI助教评估与个性化学习路径推荐</p>
                </div>

                <!-- 选项卡 -->
                <div class="mb-8">
                    <div class="flex border-b overflow-x-auto">
                        <button 
                            @click="activeTab = 'diagnostic'"
                            :class="['px-6 py-3 font-semibold text-lg border-b-2 whitespace-nowrap', 
                                    activeTab === 'diagnostic' ? 'border-purple-500 text-purple-600' : 'border-transparent text-gray-500']">
                            <i class="fas fa-user-graduate mr-2"></i>入学诊断
                        </button>
                        <button 
                            @click="activeTab = 'learning-path'"
                            :class="['px-6 py-3 font-semibold text-lg border-b-2 ml-8 whitespace-nowrap', 
                                    activeTab === 'learning-path' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500']">
                            <i class="fas fa-route mr-2"></i>学习路径
                        </button>
                        <button 
                            @click="activeTab = 'upload'"
                            :class="['px-6 py-3 font-semibold text-lg border-b-2 ml-8 whitespace-nowrap', 
                                    activeTab === 'upload' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500']">
                            <i class="fas fa-upload mr-2"></i>作业提交
                        </button>
                        <button 
                            @click="activeTab = 'history'"
                            :class="['px-6 py-3 font-semibold text-lg border-b-2 ml-8 whitespace-nowrap', 
                                    activeTab === 'history' ? 'border-orange-500 text-orange-600' : 'border-transparent text-gray-500']">
                            <i class="fas fa-history mr-2"></i>学习记录
                        </button>
                    </div>
                </div>

                <!-- 入学诊断模式 -->
                <div v-show="activeTab === 'diagnostic'" class="bg-white rounded-xl card-shadow p-8">
                    <div v-if="!diagnosticStarted && !diagnosticCompleted">
                        <div class="text-center mb-8">
                            <i class="fas fa-brain text-6xl text-purple-500 mb-4"></i>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">AI课程入学诊断测试</h3>
                            <p class="text-gray-600 text-lg mb-6">通过这个测试，我们将了解你的技术基础和学习偏好，为你推荐最适合的学习路径</p>
                        </div>
                        
                        <div class="diagnostic-card p-6 rounded-lg mb-6">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">测试内容包括：</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                                    <i class="fas fa-lightbulb text-blue-500 mr-3"></i>
                                    <span>基础概念测试 (5分钟)</span>
                                </div>
                                <div class="flex items-center p-3 bg-green-50 rounded-lg">
                                    <i class="fas fa-code text-green-500 mr-3"></i>
                                    <span>编程能力测试 (8分钟)</span>
                                </div>
                                <div class="flex items-center p-3 bg-yellow-50 rounded-lg">
                                    <i class="fas fa-tools text-yellow-500 mr-3"></i>
                                    <span>工具熟悉度调查 (2分钟)</span>
                                </div>
                                <div class="flex items-center p-3 bg-purple-50 rounded-lg">
                                    <i class="fas fa-heart text-purple-500 mr-3"></i>
                                    <span>学习偏好调查 (2分钟)</span>
                                </div>
                            </div>
                        </div>

                        <form @submit.prevent="startDiagnostic">
                            <div class="mb-6">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">学生ID</label>
                                <input 
                                    v-model="diagnosticForm.studentId" 
                                    type="text" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    placeholder="请输入学生ID">
                            </div>
                            
                            <div class="text-center">
                                <button 
                                    type="submit"
                                    :disabled="loading"
                                    class="bg-gradient-to-r from-purple-500 to-pink-600 text-white py-4 px-8 rounded-lg font-semibold text-lg hover:from-purple-600 hover:to-pink-700 transition duration-300 disabled:opacity-50">
                                    <span v-if="loading">
                                        <i class="fas fa-spinner fa-spin mr-2"></i>加载中...
                                    </span>
                                    <span v-else>
                                        <i class="fas fa-rocket mr-2"></i>开始诊断测试 (约15分钟)
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- 诊断测试进行中 -->
                    <div v-else-if="diagnosticStarted && !diagnosticCompleted" class="space-y-6">
                        <div class="text-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">正在进行诊断测试</h3>
                            <p class="text-gray-600">请根据提示完成测试题目</p>
                        </div>
                        
                        <!-- 这里可以展示实际的测试题目 -->
                        <div class="bg-gray-100 p-8 rounded-lg text-center">
                            <i class="fas fa-clipboard-list text-6xl text-gray-400 mb-4"></i>
                            <p class="text-xl text-gray-600 mb-4">模拟诊断测试界面</p>
                            <p class="text-gray-500 mb-6">实际实现中，这里将显示具体的测试题目</p>
                            <button 
                                @click="completeDiagnostic"
                                class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition">
                                <i class="fas fa-check mr-2"></i>完成测试 (演示)
                            </button>
                        </div>
                    </div>

                    <!-- 诊断完成 -->
                    <div v-else-if="diagnosticCompleted && studentProfile" class="space-y-6">
                        <div class="text-center mb-6">
                            <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">诊断测试完成！</h3>
                            <p class="text-gray-600">已为您生成个性化学习画像和路径推荐</p>
                        </div>

                        <!-- 学习画像展示 -->
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">
                                <i class="fas fa-user-circle mr-2 text-blue-500"></i>您的学习画像
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">学习水平：</span>
                                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">{{ studentProfile.level }}</span>
                                    </div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">学习风格：</span>
                                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">{{ getStyleText(studentProfile.learning_style) }}</span>
                                    </div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">时间预算：</span>
                                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm">{{ studentProfile.time_budget }}小时/周</span>
                                    </div>
                                </div>
                                <div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">兴趣领域：</span>
                                        <div class="mt-1">
                                            <span v-for="interest in studentProfile.interests" :key="interest"
                                                  class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm mr-1">{{ interest }}</span>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">薄弱技能：</span>
                                        <div class="mt-1">
                                            <span v-for="skill in studentProfile.weak_skills.slice(0, 3)" :key="skill"
                                                  class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm mr-1">{{ skill }}</span>
                                            <span v-if="studentProfile.weak_skills.length > 3" class="text-gray-500 text-sm">
                                                等{{ studentProfile.weak_skills.length }}项
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 推荐路径 -->
                        <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">
                                <i class="fas fa-route mr-2 text-green-500"></i>推荐学习路径
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">起始通道：</span>
                                        <span :class="getChannelClass(pathRecommendation.recommended_channel)">
                                            {{ pathRecommendation.recommended_channel }}通道
                                        </span>
                                    </div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">预计完成时间：</span>
                                        <span class="text-blue-600 font-medium">{{ pathRecommendation.estimated_timeline.total_weeks }}周</span>
                                    </div>
                                </div>
                                <div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">学习策略：</span>
                                        <span class="text-purple-600">{{ pathRecommendation.learning_strategy.style_adaptation.approach }}</span>
                                    </div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">重点关注：</span>
                                        <span class="text-orange-600">{{ pathRecommendation.learning_strategy.interest_priorities.focus_suggestion }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="flex justify-center gap-4">
                            <button 
                                @click="viewLearningPath"
                                class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition">
                                <i class="fas fa-arrow-right mr-2"></i>查看学习路径
                            </button>
                            <button 
                                @click="resetDiagnostic"
                                class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition">
                                <i class="fas fa-redo mr-2"></i>重新测试
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 学习路径模式 -->
                <div v-show="activeTab === 'learning-path'" class="bg-white rounded-xl card-shadow p-8">
                    <div v-if="!studentProgress">
                        <div class="text-center py-12">
                            <i class="fas fa-map-signs text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">还没有学习路径</h3>
                            <p class="text-gray-500 mb-6">请先完成入学诊断测试，系统将为您生成个性化学习路径</p>
                            <button 
                                @click="activeTab = 'diagnostic'"
                                class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition">
                                <i class="fas fa-brain mr-2"></i>开始入学诊断
                            </button>
                        </div>
                    </div>
                    
                    <div v-else class="space-y-6">
                        <!-- 学习进度概览 -->
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6 rounded-lg">
                            <h3 class="text-2xl font-bold mb-4">
                                <i class="fas fa-chart-line mr-3"></i>学习进度概览
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="text-center">
                                    <div class="text-3xl font-bold">{{ studentProgress.completion_rate }}%</div>
                                    <div class="text-sm opacity-90">完成进度</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold">{{ studentProgress.completed_nodes.length }}/7</div>
                                    <div class="text-sm opacity-90">完成节点</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold">{{ studentProgress.current_channel }}</div>
                                    <div class="text-sm opacity-90">当前通道</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold">{{ Math.round(studentProgress.total_study_hours) }}h</div>
                                    <div class="text-sm opacity-90">学习时长</div>
                                </div>
                            </div>
                            
                            <!-- 进度条 -->
                            <div class="mt-4">
                                <div class="w-full bg-white bg-opacity-20 rounded-full h-3">
                                    <div class="progress-bar h-3 rounded-full" :style="{width: studentProgress.completion_rate + '%'}"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 当前任务 -->
                        <div v-if="currentTask" class="bg-yellow-50 border border-yellow-200 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">
                                <i class="fas fa-tasks mr-2 text-yellow-600"></i>当前任务
                            </h4>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-semibold text-gray-700 mb-2">{{ currentTask.node_name }}</h5>
                                    <p class="text-gray-600 mb-3">{{ currentTask.task_description }}</p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span><i class="fas fa-layer-group mr-1"></i>{{ currentTask.channel }}通道</span>
                                        <span><i class="fas fa-clock mr-1"></i>{{ currentTask.estimated_hours }}小时</span>
                                        <span><i class="fas fa-signal mr-1"></i>难度{{ currentTask.difficulty_level }}/10</span>
                                    </div>
                                </div>
                                <div>
                                    <h6 class="font-semibold text-gray-700 mb-2">任务要求：</h6>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li v-for="req in currentTask.requirements" :key="req" class="flex items-start">
                                            <i class="fas fa-check-circle text-green-500 mr-2 mt-0.5 text-xs"></i>
                                            {{ req }}
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- 学习节点路径 -->
                        <div class="space-y-4">
                            <h4 class="text-xl font-semibold text-gray-800">
                                <i class="fas fa-road mr-2 text-blue-500"></i>学习路径节点
                            </h4>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div v-for="(node, index) in learningNodes" :key="node.id" 
                                     class="path-node p-4 rounded-lg border-2" 
                                     :class="getNodeClass(node, index)">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold"
                                                 :class="getNodeIconClass(node, index)">
                                                {{ index + 1 }}
                                            </div>
                                            <h5 class="font-semibold text-gray-800 ml-3">{{ node.name }}</h5>
                                        </div>
                                        <i :class="getNodeStatusIcon(node)" class="text-lg"></i>
                                    </div>
                                    
                                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">{{ node.description }}</p>
                                    
                                    <div class="flex items-center justify-between text-xs text-gray-500">
                                        <span><i class="fas fa-layer-group mr-1"></i>ABC通道</span>
                                        <span><i class="fas fa-clock mr-1"></i>{{ getEstimatedHours(node) }}h</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 最新推荐 -->
                        <div v-if="latestRecommendation" class="bg-blue-50 border border-blue-200 p-6 rounded-lg">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">
                                <i class="fas fa-lightbulb mr-2 text-blue-600"></i>最新路径建议
                            </h4>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <div class="mb-2">
                                        <span class="font-medium text-gray-700">推荐决策：</span>
                                        <span :class="getDecisionClass(latestRecommendation.decision_type)">
                                            {{ getDecisionText(latestRecommendation.decision_type) }}
                                        </span>
                                    </div>
                                    <div class="mb-2">
                                        <span class="font-medium text-gray-700">推荐通道：</span>
                                        <span :class="getChannelClass(latestRecommendation.recommended_channel)">
                                            {{ latestRecommendation.recommended_channel }}通道
                                        </span>
                                    </div>
                                </div>
                                <div>
                                    <div class="mb-2">
                                        <span class="font-medium text-gray-700">推荐理由：</span>
                                        <p class="text-gray-600 text-sm">{{ latestRecommendation.reasoning }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 作业提交模式 (保持原有功能) -->
                <div v-show="activeTab === 'upload'" class="bg-white rounded-xl card-shadow p-8">
                    <form @submit.prevent="submitAssignment" enctype="multipart/form-data">
                        <div class="space-y-6">
                            <!-- 学生信息 -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">学生ID</label>
                                <input 
                                    v-model="uploadForm.studentId" 
                                    type="text" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="请输入学生ID">
                            </div>

                            <!-- 项目创意 -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">项目创意描述</label>
                                <textarea 
                                    v-model="uploadForm.ideaText" 
                                    rows="6" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="请详细描述您的项目创意、目标用户、核心功能等..."></textarea>
                            </div>

                            <!-- 文件上传区域 -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">上传项目文件</label>
                                <div 
                                    @dragover.prevent
                                    @drop.prevent="handleFileDrop"
                                    class="upload-area border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer"
                                    :class="{'border-blue-500 bg-blue-50': isDragging}"
                                    @dragenter="isDragging = true"
                                    @dragleave="isDragging = false">
                                    
                                    <div v-if="selectedFiles.length === 0">
                                        <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                                        <p class="text-xl text-gray-600 mb-2">拖拽文件到此处或点击选择</p>
                                        <p class="text-gray-500">支持 .zip, .tar.gz 压缩包或单个代码文件</p>
                                        <input 
                                            ref="fileInput"
                                            @change="handleFileSelect"
                                            type="file" 
                                            multiple 
                                            class="hidden"
                                            accept=".py,.js,.ts,.tsx,.jsx,.java,.cpp,.c,.zip,.tar.gz">
                                        <button 
                                            type="button"
                                            @click="$refs.fileInput.click()"
                                            class="mt-4 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                                            选择文件
                                        </button>
                                    </div>
                                    
                                    <div v-else>
                                        <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                                        <p class="text-xl text-green-600 mb-4">已选择 {{ selectedFiles.length }} 个文件</p>
                                        <div class="text-left bg-gray-50 rounded-lg p-4 max-h-40 overflow-y-auto">
                                            <div v-for="file in selectedFiles" :key="file.name" class="flex items-center justify-between py-1">
                                                <span class="text-sm text-gray-700">{{ file.name }}</span>
                                                <span class="text-xs text-gray-500">{{ formatFileSize(file.size) }}</span>
                                            </div>
                                        </div>
                                        <button 
                                            type="button"
                                            @click="clearFiles"
                                            class="mt-4 text-red-500 hover:text-red-600">
                                            <i class="fas fa-times mr-1"></i>清除文件
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 提交按钮 -->
                            <button 
                                type="submit"
                                :disabled="loading || selectedFiles.length === 0"
                                class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 px-8 rounded-lg font-semibold text-lg
                                       hover:from-blue-600 hover:to-purple-700 transition duration-300 disabled:opacity-50">
                                <span v-if="loading">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>评估中...
                                </span>
                                <span v-else>
                                    <i class="fas fa-rocket mr-2"></i>提交作业评估
                                </span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 学习记录模式 -->
                <div v-show="activeTab === 'history'" class="bg-white rounded-xl card-shadow p-8">
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-history mr-2 text-orange-500"></i>学习记录与评估历史
                        </h3>
                        
                        <!-- 筛选器 -->
                        <div class="flex flex-wrap gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">学生ID筛选</label>
                                <input 
                                    v-model="historyFilter.studentId" 
                                    type="text" 
                                    class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                    placeholder="输入学生ID筛选">
                            </div>
                            <div class="flex items-end">
                                <button 
                                    @click="loadHistory"
                                    :disabled="historyLoading"
                                    class="bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition disabled:opacity-50">
                                    <i class="fas fa-search mr-2" :class="{'fa-spin': historyLoading}"></i>
                                    {{ historyLoading ? '加载中...' : '查询' }}
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 历史记录列表 -->
                    <div v-if="historyData.length > 0">
                        <div class="space-y-4 max-h-96 overflow-y-auto">
                            <div 
                                v-for="record in filteredHistory" 
                                :key="record.assessment_id"
                                class="border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition"
                                @click="viewHistoryDetail(record)">
                                
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center mb-2">
                                            <h4 class="font-semibold text-gray-800">{{ record.student_id }}</h4>
                                            <span 
                                                :class="getStatusBadgeClass(record.status)"
                                                class="ml-3 px-2 py-1 rounded-full text-xs font-medium">
                                                {{ getStatusText(record.status) }}
                                            </span>
                                            <span v-if="record.overall_score" class="ml-2 text-sm text-gray-600">
                                                分数: {{ record.overall_score.toFixed(1) }}
                                            </span>
                                        </div>
                                        <div class="flex items-center text-xs text-gray-500">
                                            <i class="fas fa-clock mr-1"></i>
                                            <span>{{ formatDateTime(record.created_at) }}</span>
                                        </div>
                                    </div>
                                    <div class="ml-4">
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 空状态 -->
                    <div v-else-if="!historyLoading" class="text-center py-12">
                        <i class="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
                        <p class="text-xl text-gray-500 mb-2">暂无学习记录</p>
                        <p class="text-gray-400">请先完成入学诊断或提交作业</p>
                    </div>
                </div>
            </div>

            <!-- 评估结果显示 (集成路径推荐) -->
            <div v-if="assessmentResult" class="max-w-6xl mx-auto mt-16">
                <div class="result-card bg-white rounded-xl card-shadow overflow-hidden">
                    <!-- 结果头部 -->
                    <div class="bg-gradient-to-r from-green-500 to-blue-600 text-white p-6">
                        <h3 class="text-2xl font-bold mb-2">
                            <i class="fas fa-check-circle mr-3"></i>作业评估完成
                        </h3>
                        <p class="opacity-90">评估ID: {{ assessmentResult.assessment_id }}</p>
                    </div>

                    <div class="p-8">
                        <!-- 评分概览 -->
                        <div v-if="assessmentResult.overall_score" class="mb-8">
                            <h4 class="text-xl font-semibold mb-4 text-gray-800">评估结果</h4>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                                <div class="text-center bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg">
                                    <div class="text-3xl font-bold text-blue-600">{{ assessmentResult.overall_score.toFixed(1) }}</div>
                                    <div class="text-gray-600 font-semibold">总分</div>
                                </div>
                                <div class="text-center bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-purple-600">{{ assessmentResult.breakdown?.idea || 0 }}</div>
                                    <div class="text-gray-600 font-semibold">创意</div>
                                </div>
                                <div class="text-center bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-green-600">{{ assessmentResult.breakdown?.ui || 0 }}</div>
                                    <div class="text-gray-600 font-semibold">UI</div>
                                </div>
                                <div class="text-center bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-lg">
                                    <div class="text-2xl font-bold text-orange-600">{{ assessmentResult.breakdown?.code || 0 }}</div>
                                    <div class="text-gray-600 font-semibold">代码</div>
                                </div>
                            </div>
                        </div>

                        <!-- 🆕 路径推荐结果 -->
                        <div v-if="assessmentResult.path_recommendation" class="mb-8 bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-lg border border-indigo-200">
                            <h4 class="text-xl font-semibold mb-4 text-gray-800">
                                <i class="fas fa-route mr-2 text-indigo-600"></i>智能路径推荐
                            </h4>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">推荐决策：</span>
                                        <span :class="getDecisionClass(assessmentResult.path_recommendation.decision_type)">
                                            {{ getDecisionText(assessmentResult.path_recommendation.decision_type) }}
                                        </span>
                                    </div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">推荐通道：</span>
                                        <span :class="getChannelClass(assessmentResult.path_recommendation.channel)">
                                            {{ assessmentResult.path_recommendation.channel }}通道
                                        </span>
                                    </div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">下一节点：</span>
                                        <span class="text-blue-600 font-medium">{{ getNodeName(assessmentResult.path_recommendation.next_node_id) }}</span>
                                    </div>
                                </div>
                                <div>
                                    <div class="mb-3">
                                        <span class="font-medium text-gray-700">推荐理由：</span>
                                        <p class="text-gray-600 text-sm mt-1">{{ assessmentResult.path_recommendation.reasoning }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="flex gap-4">
                            <button 
                                @click="acceptPathRecommendation"
                                v-if="assessmentResult.path_recommendation"
                                class="bg-indigo-500 text-white px-6 py-2 rounded-lg hover:bg-indigo-600 transition">
                                <i class="fas fa-check mr-2"></i>接受路径推荐
                            </button>
                            <button 
                                @click="viewLearningPath"
                                class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition">
                                <i class="fas fa-map mr-2"></i>查看学习路径
                            </button>
                            <button 
                                @click="resetForm"
                                class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition">
                                <i class="fas fa-plus mr-2"></i>提交新作业
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 页脚 -->
        <footer class="bg-gray-800 text-white py-8 mt-16">
            <div class="container mx-auto px-6 text-center">
                <p>&copy; 2024 AI助教评估与个性化学习路径系统. All rights reserved.</p>
                <p class="mt-2 text-gray-400">智能教学，因材施教</p>
            </div>
        </footer>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    activeTab: 'diagnostic',
                    loading: false,
                    isDragging: false,
                    selectedFiles: [],
                    
                    // 诊断相关数据
                    diagnosticStarted: false,
                    diagnosticCompleted: false,
                    diagnosticForm: {
                        studentId: ''
                    },
                    studentProfile: null,
                    pathRecommendation: null,
                    
                    // 学习路径相关数据
                    studentProgress: null,
                    currentTask: null,
                    learningNodes: [],
                    latestRecommendation: null,
                    
                    // 作业提交数据
                    uploadForm: {
                        studentId: '',
                        ideaText: ''
                    },
                    assessmentResult: null,
                    
                    // 历史记录数据
                    historyData: [],
                    historyLoading: false,
                    historyFilter: {
                        studentId: ''
                    }
                }
            },
            computed: {
                filteredHistory() {
                    let filtered = this.historyData
                    if (this.historyFilter.studentId) {
                        const studentId = this.historyFilter.studentId.toLowerCase().trim()
                        filtered = filtered.filter(record => 
                            record.student_id.toLowerCase().includes(studentId)
                        )
                    }
                    return filtered
                }
            },
            methods: {
                // ================ 诊断测试方法 ================
                async startDiagnostic() {
                    if (!this.diagnosticForm.studentId.trim()) {
                        alert('请输入学生ID')
                        return
                    }
                    
                    this.loading = true
                    try {
                        // 模拟开始诊断测试
                        this.diagnosticStarted = true
                        // 实际实现中，这里会调用诊断API
                        // const response = await fetch('/api/learning-path/diagnostic', {...})
                    } catch (error) {
                        alert('启动诊断测试失败: ' + error.message)
                        this.diagnosticStarted = false
                    } finally {
                        this.loading = false
                    }
                },
                
                async completeDiagnostic() {
                    this.loading = true
                    try {
                        // 模拟诊断完成，提交结果
                        const mockDiagnosticResults = {
                            concept_score: 75,
                            coding_score: 68,
                            tool_familiarity: 80,
                            skill_scores: {
                                "Python基础": 70,
                                "Git": 45,
                                "HTTP协议": 65
                            },
                            interests: ["RAG", "Agent"],
                            learning_style_preference: "examples_first",
                            time_budget_hours_per_week: 8,
                            goals: ["完成RAG应用", "掌握全栈开发"]
                        }
                        
                        const response = await fetch('/api/learning-path/diagnostic', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                student_id: this.diagnosticForm.studentId,
                                diagnostic_results: mockDiagnosticResults
                            })
                        })
                        
                        if (response.ok) {
                            const result = await response.json()
                            this.studentProfile = result.student_profile
                            this.pathRecommendation = result.recommendations
                            this.diagnosticCompleted = true
                            this.diagnosticStarted = false
                        } else {
                            throw new Error('诊断评估失败')
                        }
                    } catch (error) {
                        alert('完成诊断失败: ' + error.message)
                    } finally {
                        this.loading = false
                    }
                },
                
                resetDiagnostic() {
                    this.diagnosticStarted = false
                    this.diagnosticCompleted = false
                    this.studentProfile = null
                    this.pathRecommendation = null
                    this.diagnosticForm.studentId = ''
                },
                
                // ================ 学习路径方法 ================
                async loadStudentProgress() {
                    if (!this.diagnosticForm.studentId) return
                    
                    try {
                        const response = await fetch(`/api/learning-path/progress/${this.diagnosticForm.studentId}`)
                        if (response.ok) {
                            const data = await response.json()
                            this.studentProgress = data.progress_summary
                            this.currentTask = data.current_task
                            await this.loadLearningPath()
                        }
                    } catch (error) {
                        console.error('加载学生进度失败:', error)
                    }
                },
                
                async loadLearningPath() {
                    try {
                        const response = await fetch('/api/learning-path/path/info')
                        if (response.ok) {
                            const data = await response.json()
                            this.learningNodes = data.nodes
                        }
                    } catch (error) {
                        console.error('加载学习路径失败:', error)
                    }
                },
                
                viewLearningPath() {
                    this.activeTab = 'learning-path'
                    this.loadStudentProgress()
                },
                
                async acceptPathRecommendation() {
                    // 这里实现接受路径推荐的逻辑
                    alert('路径推荐已应用到您的学习计划中！')
                    this.viewLearningPath()
                },
                
                // ================ 作业提交方法 ================
                async submitAssignment() {
                    if (!this.uploadForm.studentId || !this.uploadForm.ideaText || this.selectedFiles.length === 0) {
                        alert('请填写所有必填信息并选择文件')
                        return
                    }

                    this.loading = true
                    try {
                        const formData = new FormData()
                        formData.append('student_id', this.uploadForm.studentId)
                        formData.append('idea_text', this.uploadForm.ideaText)
                        
                        this.selectedFiles.forEach(file => {
                            formData.append('files', file)
                        })

                        const response = await fetch('/api/assessment/submit', {
                            method: 'POST',
                            body: formData
                        })

                        if (response.ok) {
                            const result = await response.json()
                            this.assessmentResult = result
                            
                            // 等待评估完成并获取路径推荐
                            setTimeout(() => {
                                this.checkAssessmentWithPath(result.assessment_id)
                            }, 3000)
                            
                            this.scrollToResult()
                        } else {
                            const error = await response.json()
                            alert('提交失败: ' + (error.detail || '未知错误'))
                        }
                    } catch (error) {
                        alert('提交失败: ' + error.message)
                    } finally {
                        this.loading = false
                    }
                },
                
                async checkAssessmentWithPath(assessmentId) {
                    try {
                        const response = await fetch(`/api/assessment/${assessmentId}`)
                        if (response.ok) {
                            const result = await response.json()
                            if (result.status === 'completed') {
                                this.assessmentResult = result
                                
                                // 模拟路径推荐结果
                                this.assessmentResult.path_recommendation = {
                                    decision_type: 'keep',
                                    channel: 'B',
                                    next_node_id: 'model_deployment',
                                    reasoning: '基于您的优秀表现，建议继续在B通道学习下一个节点'
                                }
                            }
                        }
                    } catch (error) {
                        console.error('检查评估状态失败:', error)
                    }
                },
                
                // ================ 历史记录方法 ================
                async loadHistory() {
                    this.historyLoading = true
                    try {
                        let url = '/api/assessment/history'
                        const params = new URLSearchParams()
                        
                        if (this.historyFilter.studentId.trim()) {
                            params.append('student_id', this.historyFilter.studentId.trim())
                        }
                        
                        if (params.toString()) {
                            url += '?' + params.toString()
                        }
                        
                        const response = await fetch(url)
                        if (response.ok) {
                            const data = await response.json()
                            this.historyData = data.assessments || []
                        }
                    } catch (error) {
                        console.error('加载历史记录失败:', error)
                    } finally {
                        this.historyLoading = false
                    }
                },
                
                viewHistoryDetail(record) {
                    // 查看历史记录详情
                    this.assessmentResult = record
                    this.scrollToResult()
                },
                
                // ================ 工具方法 ================
                handleFileSelect(event) {
                    this.selectedFiles = Array.from(event.target.files)
                },
                
                handleFileDrop(event) {
                    this.isDragging = false
                    this.selectedFiles = Array.from(event.dataTransfer.files)
                },
                
                clearFiles() {
                    this.selectedFiles = []
                    if (this.$refs.fileInput) {
                        this.$refs.fileInput.value = ''
                    }
                },
                
                formatFileSize(bytes) {
                    if (bytes === 0) return '0 B'
                    const k = 1024
                    const sizes = ['B', 'KB', 'MB', 'GB']
                    const i = Math.floor(Math.log(bytes) / Math.log(k))
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
                },
                
                resetForm() {
                    this.assessmentResult = null
                    this.selectedFiles = []
                    this.uploadForm = { studentId: '', ideaText: '' }
                    if (this.$refs.fileInput) {
                        this.$refs.fileInput.value = ''
                    }
                    window.scrollTo({ top: 0, behavior: 'smooth' })
                },
                
                scrollToResult() {
                    this.$nextTick(() => {
                        const element = document.querySelector('.result-card')
                        if (element) {
                            element.scrollIntoView({ behavior: 'smooth' })
                        }
                    })
                },
                
                // ================ 样式方法 ================
                getStyleText(style) {
                    const styleMap = {
                        'examples_first': '示例优先学习',
                        'theory_first': '理论优先学习',
                        'hands_on': '动手实践学习',
                        'visual': '可视化学习'
                    }
                    return styleMap[style] || style
                },
                
                getChannelClass(channel) {
                    const classMap = {
                        'A': 'bg-green-100 text-green-800 px-2 py-1 rounded text-sm',
                        'B': 'bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm',
                        'C': 'bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm'
                    }
                    return classMap[channel] || 'bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm'
                },
                
                getDecisionClass(decision) {
                    const classMap = {
                        'upgrade': 'bg-green-100 text-green-800 px-2 py-1 rounded text-sm',
                        'keep': 'bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm', 
                        'downgrade_with_scaffold': 'bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm'
                    }
                    return classMap[decision] || 'bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm'
                },
                
                getDecisionText(decision) {
                    const textMap = {
                        'upgrade': '升级通道',
                        'keep': '保持当前',
                        'downgrade_with_scaffold': '降级辅导'
                    }
                    return textMap[decision] || decision
                },
                
                getNodeClass(node, index) {
                    // 根据节点状态返回样式类
                    return 'border-gray-200 bg-white hover:border-blue-300'
                },
                
                getNodeIconClass(node, index) {
                    // 根据节点状态返回图标样式
                    return 'bg-blue-500'
                },
                
                getNodeStatusIcon(node) {
                    // 根据节点状态返回状态图标
                    return 'fas fa-clock text-gray-400'
                },
                
                getEstimatedHours(node) {
                    // 获取节点预估时间
                    return node.estimated_hours?.B || 8
                },
                
                getNodeName(nodeId) {
                    const nodeNames = {
                        'api_calling': 'API调用',
                        'model_deployment': '模型部署', 
                        'no_code_ai': '零代码配置AI应用',
                        'rag_system': 'RAG系统',
                        'ui_design': 'UI设计',
                        'frontend_dev': '前端开发',
                        'backend_dev': '后端开发'
                    }
                    return nodeNames[nodeId] || nodeId
                },
                
                getStatusText(status) {
                    const statusMap = {
                        'completed': '已完成',
                        'in_progress': '进行中',
                        'queued': '排队中',
                        'failed': '失败'
                    }
                    return statusMap[status] || status
                },
                
                getStatusBadgeClass(status) {
                    const classMap = {
                        'completed': 'bg-green-100 text-green-800',
                        'in_progress': 'bg-orange-100 text-orange-800',
                        'queued': 'bg-blue-100 text-blue-800',
                        'failed': 'bg-red-100 text-red-800'
                    }
                    return classMap[status] || 'bg-gray-100 text-gray-800'
                },
                
                formatDateTime(dateTimeStr) {
                    if (!dateTimeStr) return ''
                    try {
                        const date = new Date(dateTimeStr)
                        return date.toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        })
                    } catch {
                        return dateTimeStr
                    }
                }
            },
            watch: {
                // 监听标签页切换
                activeTab(newTab) {
                    if (newTab === 'history' && this.historyData.length === 0) {
                        this.loadHistory()
                    } else if (newTab === 'learning-path' && this.diagnosticForm.studentId) {
                        this.loadStudentProgress()
                    }
                }
            },
            mounted() {
                // 页面加载时的初始化逻辑
                console.log('AI助教评估与个性化学习路径系统已加载')
            }
        }).mount('#app')
    </script>
</body>
</html>
